<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Life expectancy trends in the former USSR  &middot; KYLE WALKER DATA</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="R, rCharts, Shiny, ">


<meta property="og:title" content="Life expectancy trends in the former USSR  &middot; KYLE WALKER DATA ">
<meta property="og:site_name" content="KYLE WALKER DATA"/>
<meta property="og:url" content="/2014/10/russia-lex/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2014-10-16T00:00:00Z" />
<meta property="og:article:modified_time" content="2014-10-16T00:00:00Z" />

  
    
<meta property="og:article:tag" content="R">
    
<meta property="og:article:tag" content="rCharts">
    
<meta property="og:article:tag" content="Shiny">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kyle_e_walker" />
<meta name="twitter:creator" content="@kyle_e_walker" />
<meta name="twitter:title" content="Life expectancy trends in the former USSR" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="/2014/10/russia-lex/" />
<meta name="twitter:domain" content="/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Life expectancy trends in the former USSR",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2014-10-16",
    "description": "",
    "wordCount":  1352 
  }
</script>



<link rel="canonical" href="../../../2014/10/russia-lex/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../../touch-icon-144-precomposed.png">
<link href="../../../favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.17" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link href='https://fonts.googleapis.com/css?family=Merriweather:300%7CRaleway%7COpen+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="../../../css/font-awesome.min.css">
<link rel="stylesheet" href="../../../css/style.css">
<link rel="stylesheet" href="../../../css/highlight/zenburn.css">

  <!DOCTYPE HTML>
<style>
  
  .main_wrapper>.main_header {
    background-color: #035004;
    color: #fff;
  }
  
  .main_wrapper>.main_content .label:hover,
  .main_wrapper>.main_content .navigation a:hover,
  .main_wrapper>.main_content .pagination a:hover,
  .main_wrapper>.main_content .readlink a:hover,
  .main_wrapper>.main_content h2 a:hover,
  .main_wrapper>.main_header a:hover {
    background-color: #035004;
    color: #fff;
    text-decoration: none; 
}

  a {
    color: #1a730f; 
  }
  
  a:active, a:focus, a:hover {
    color: #035004;
}
  
</style>

</head>
<body class="map[name:superhero]">
  <main id="main-wrapper" class="container main_wrapper has-sidebar">
    <header id="main-header" class="container main_header">
  <div class="container brand">
  <div class="container title h1-like">
  <a class="baselink" href="../../../">
  KYLE WALKER DATA

</a>

</div>

  
<div class="container topline">
  
  Writing about visualization, demographics, dashboards, and spatial data science. <br/><br/>Interested in learning more?  Hire me for a workshop or to consult on your next project.  See the Services page for more details.


</div>


</div>

  <nav class="container nav primary no-print">
  


  
<a href="../../../about">About</a>

<a href="../../../post" title="Show list of posts">Posts</a>

<a href="../../../tags" title="Show list of tags">Tags</a>

<a href="../../../services">Services</a>

<a href="https://www.r-bloggers.com/">R-Bloggers</a>


</nav>

<div class="container nav secondary no-print">
  
<a id="contact-link-email" class="contact_link" href="mailto:kwalkerdata@gmail.com">
  <span class="fa fa-envelope-square"></span><span>email</span></a>



<a id="contact-link-github" class="contact_link" href="https://github.com/walkerke">
  <span class="fa fa-github-square"></span><span>github</span></a>





<a id="contact-link-linkedin" class="contact_link" href="https://www.linkedin.com/in/walkerke">
  <span class="fa fa-linkedin-square"></span><span>linkedin</span></a>







<a id="contact-link-twitter" class="contact_link" href="https://twitter.com/kyle_e_walker">
  <span class="fa fa-twitter-square"></span><span>twitter</span></a>













</div>


  

</header>


<article id="main-content" class="container main_content single">
  <header class="container hat">
  <h1>Life expectancy trends in the former USSR
</h1>

  <div class="metas">
<time datetime="2014-10-16">16 Oct, 2014</time>


  
    &middot; by Kyle Walker
  
  &middot; Read in about 7 min
  &middot; (1352 Words)
  <br>
  
<a class="label" href="../../../tags/r">R</a>

<a class="label" href="../../../tags/rcharts">rCharts</a>

<a class="label" href="../../../tags/shiny">Shiny</a>



</div>

</header>

  <div class="container content">
  <p>When covering Russia and the former republics of the USSR in World Regional Geography, a key part of my material addresses the issues that some of these countries have had in their transitions from centralized to market economies.  Some of these countries experienced dramatic demographic shifts after the dissolution of the USSR, including a noticeable decline in life expectancy.</p>

<p>I&rsquo;d been using some static Excel charts to illustrate life expectancy declines in Russia, Belarus, and Ukraine in previous courses.  However, I felt that an interactive solution would be preferable so that my students and I could explore the data in class over the course of our discussion.  I opted for <a href="http://www.highcharts.com/">Highcharts</a>, through R and <a href="http://rcharts.io">rCharts</a>, for the interactivity.  I then turned to <a href="http://shiny.rstudio.com/">Shiny</a> from <a href="http://www.rstudio.com/">RStudio</a> to put everything together.</p>

<p>Shiny is a framework that allows R users to turn analyses and visualizations into interactive applications.  Shiny can be run locally on your computer, or deployed to the web via the <a href="https://www.shinyapps.io/">ShinyApps.io</a> hosting service, which is currently free.  The beauty of Shiny is that it allows you to explore your data interactively with a friendly web-based user interface without writing any JavaScript, and it lets R users create and deploy apps to be shared with non-R users who may nonetheless be interested in exploring a dataset or visualization. <a href="http://shiny.rstudio.com/gallery/">You can see RStudio&rsquo;s gallery of examples here.</a></p>

<p>To get started, I acquired data from <a href="http://www.mortality.org/">The Human Mortality Database</a>, (HMD) a project of UC Berkeley and the Max Planck Institute.  The HMD prefers that users not re-distribute the data, so if you&rsquo;d like to reproduce this chart, you&rsquo;ll need to download the data yourself.  However, the service is free (with registration) and relatively simple to use.  The HMD provides mortality data for 37 countries, including Russia, Belarus, and Ukraine. From the HMD, I downloaded the 1-year life expectancy at birth tables for these countries, and saved them to my working directory as delimited text files, naming them accordingly.  Once I did this, I used the code below to process the data into a suitable format for visualization.</p>

<pre><code class="language-r">
library(tidyr)
library(dplyr)

russia &lt;- read.table('russia.txt', skip = 3)

names(russia) &lt;- c(&quot;Year&quot;, &quot;Female&quot;, &quot;Male&quot;, &quot;Total&quot;)

russia$country &lt;- &quot;Russia&quot;

ukraine &lt;- read.table('ukraine.txt', skip = 3)

names(ukraine) &lt;- c(&quot;Year&quot;, &quot;Female&quot;, &quot;Male&quot;, &quot;Total&quot;)

ukraine$country &lt;- &quot;Ukraine&quot;

belarus &lt;- read.table('belarus.txt', skip = 3)

names(belarus) &lt;- c(&quot;Year&quot;, &quot;Female&quot;, &quot;Male&quot;, &quot;Total&quot;)

belarus$country &lt;- &quot;Belarus&quot;

dat &lt;- rbind(russia, ukraine, belarus)

dlong &lt;- dat %&gt;%
  select(-Total) %&gt;%
  gather(Gender, lex, Female:Male)

write.csv(dlong, 'data.csv')

</code></pre>

<p>In a nutshell, the above code reads in each of the three text files, identifies the country the data correspond to, then combines them.  It then uses functions from the <a href="http://cran.r-project.org/web/packages/dplyr/index.html">dplyr</a> and <a href="http://cran.r-project.org/web/packages/tidyr/index.html">tidyr</a> packages to convert the data to &ldquo;tidy&rdquo; (long) format, which is what I want for visualization.  I then saved the data as a CSV and moved it to a new folder where I would create my Shiny app.</p>

<p>A Shiny app requires two files to run: <strong>server.R</strong>, which specifies the data analysis/visualization to show, and <strong>ui.R</strong>, in which you prepare the user interface.  An optional third file (which I haven&rsquo;t used here), <strong>global.R</strong>, can be used to read in data or do any background data preparation that you want to make available to both the server and UI scripts.  I largely adapted my server and UI code from <a href="http://shiny.rstudio.com/tutorial/">RStudio&rsquo;s Shiny tutorials</a> and <a href="http://ramnathv.github.io/rChartsShiny/">Ramnath Vaidyanathan&rsquo;s tutorial on using rCharts with Shiny</a>, with some help from StackOverflow as well.</p>

<p>I prepared the UI first with the code below.</p>

<pre><code class="language-r">
# ui.R

library(rCharts)

dat &lt;- read.csv('data.csv')

# Define UI 
shinyUI(fluidPage(
  
  # Sidebar 
  sidebarLayout(
    sidebarPanel(
      selectInput(inputId = &quot;country&quot;, 
                  label = &quot;Select a country:&quot;, 
                  choices = c(&quot;Russia&quot;, &quot;Belarus&quot;, &quot;Ukraine&quot;), 
                  selected = &quot;Russia&quot;), 
      sliderInput(&quot;range&quot;,
                  label = &quot;Years to display:&quot;,
                  min = 1959,
                  max = 2010,
                  value = c(1959, 2010), 
                  format = &quot;0000&quot;), 
      helpText(&quot;Data reflect the life expectancy &quot;, 
                &quot;at birth from 1959 to 2010 &quot;, 
               &quot;for men and women in Russia, &quot;, 
                &quot;Belarus, and Ukraine.  Data are &quot;, 
               &quot;obtained from the Human Mortality &quot;, 
                &quot;Database, a project of &quot;, 
                &quot; the University of California, &quot;, 
                &quot;Berkeley (USA), and Max Planck &quot;, 
                &quot;Institute for Demographic Research &quot;, 
                &quot;(Germany). Data are available &quot;, 
                &quot;at www.mortality.org or www.humanmortality.de &quot;, 
               &quot;(downloaded on 14 Oct 2014).&quot;)
    ),
    
    # Show the plot 
    mainPanel(
      showOutput(&quot;lexplot&quot;, &quot;highcharts&quot;)
    )
  )
))

</code></pre>

<p>In the <strong>ui.R</strong> script, I define the parameters of the Shiny user interface.  I&rsquo;ll have a drop-down menu to select the country of choice (Russia, Belarus, or Ukraine), as well as a time slider that allows the user to specify the years to show in the chart.  I then use the <code>showOutput</code> function from rCharts in the <code>mainPanel</code> call to tell Shiny to show my chart in the main area.</p>

<p>Next, I set up the server.</p>

<pre><code class="language-r">
# server.R

library(rCharts)

dat &lt;- read.csv('data.csv')

options(RCHART_WIDTH = 500)

shinyServer(function(input, output) {
  output$lexplot &lt;- renderChart2({
    selected &lt;- input$country
    country &lt;- subset(dat, country == selected &amp; Year %in% seq(input$range[1], input$range[2], 1))
    h1 &lt;- hPlot(
      x = &quot;Year&quot;, 
      y = &quot;lex&quot;, 
      group = &quot;Gender&quot;, 
      data = country, 
      type = &quot;line&quot;)
    
    h1$colors(c(&quot;red&quot;, &quot;blue&quot;))
    h1$yAxis(title = list(enabled = TRUE, text = 'Life expectancy at birth'))
    return(h1)
  })
})

</code></pre>

<p>The key here to get this to work is to make sure that your <strong>server.R</strong> and <strong>ui.R</strong> scripts communicate correctly.  My UI takes an input that is dependent upon the country and years selected by the user, so I create a subsetted data frame, <code>country</code>, within the <code>renderChart2</code> function that will respond to that.  I then specify the parameters of the Highchart plot, and tell my <code>renderChart2</code> function to return that plot and assign it to the <code>lexplot</code> property of the output, which is what my user interface script will expect.</p>

<p>RStudio will know that you are creating a Shiny app (given the names of your scripts), so you can simply click the <strong>Run App</strong> button to run your app locally, and then deploy it to ShinyApps if you&rsquo;d like.  Now, let&rsquo;s take a look at the result.  Click the image below to access the application (I&rsquo;m trying to cut down on my usage for my ShinyApps.io free account).  Use the drop-down menu to select a country, and the time slider to specify a range of years to display.</p>

<hr />

<p><a href="https://walkerke.shinyapps.io/lex_former_ussr/"><img src=http://walkerke.github.io/img/russia_shiny.PNG></a></p>

<hr />

<p>I now have an application that allows me to seamlessly switch between countries, change years, and explore the data thanks to Highcharts&rsquo; built-in interactivity.  The charts reveal key trends in life expectancy both pre- and post- USSR.  In Russia, for example, we see that life expectancy declines through the mid-20th century, then peaks in the 1980s, <a href="http://www.rand.org/pubs/conf_proceedings/CF124/cf124.chap4.html">which is attributed to Mikhail Gorbachev&rsquo;s anti-alcohol campaign.</a>  Life expectancy then falls dramatically around the time that the USSR dissolved.  For example, male life expectancy in 1994 in Russia was a little over 57, around 7.5 years less than its peak in 1987.  <a href="http://www.ncbi.nlm.nih.gov/pubmed/9508159">Studies have attributed this to a variety of factors, including alcohol abuse, poor nutrition and health behaviors, and problems with the health care system.</a>  However, life expectancy improves in the late 2000s, <a href="http://www.demographic-research.org/volumes/vol28/32/28-32.pdf">in part due to declines in cardiovascular disease and homicides</a>.</p>

<p>In class, I first presented the chart (which displays very nicely in a <a href="http://ramnathv.github.io/slidify/">Slidify</a> presentation) and explored the data with my students.  I then showed my students the first segment from the documentary <a href="https://www.youtube.com/watch?v=J1OyIJtjdpo">Death of a Nation: Russia</a> by Marcel Theroux which explores some of the underlying issues behind these demographic changes in more depth.  We then used the video to collectively think about some reasons for the decline of life expectancy in Russia after the fall of the USSR.  The video paired very nicely with the interactive Shiny app; the charts provided key visual demographic context, and the video then put faces to the data.</p>

<p>The app is fully reproducible (just make sure you download the data from <a href="http://www.mortality.org">the Human Mortality Database</a> first) and you can find the code in its <a href="https://github.com/walkerke/teaching-with-datavis/tree/master/russia-lex">GitHub repository</a>.  Feel free to use the app as you&rsquo;d like, or modify the code as you wish to create your own apps!</p>

<p><strong>Thanks to:</strong></p>

<ul>
<li>The creators of the Human Mortality Database for making their data freely available</li>
<li>The <a href="http://http://www.rstudio.com/">RStudio</a> team for Shiny and all its associated training materials</li>
<li>The developers of rCharts and Highcharts</li>
</ul>

</div>


  <footer class="container">
  <div class="container navigation no-print">
  <h2>Navigation</h2>
  
  

    
    <a class="prev" href="../../../2014/08/un-projections/" title="Exploring the United Nations population projections with rCharts">
      Previous
    </a>
    

    
    <a class="next" href="../../../2014/12/using-slidify-to-teach-with-interactive-content/" title="Using Slidify to teach with interactive content">
      Next
    </a>
    

  


</div>

  

</footer>

</article>
      <footer id="main-footer" class="container main_footer">
  

  <div class="container nav foot no-print">
  

  <a class="toplink" href="#">back to top</a>

</div>

  <div class="container credits">
  
<div class="container footline">
  

</div>


  
<div class="container copyright">
  
  &copy; 2017 Kyle Walker


</div>


</div>

</footer>

    </main>
    
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//your_disqus_shortname.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="../../../js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51388803-1', 'auto');
  ga('send', 'pageview');

</script>


    
  </body>
</html>

