<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Interactive international population pyramids with R, rCharts  &middot; Kyle Walker</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="R, rCharts, ">


<meta property="og:title" content="Interactive international population pyramids with R, rCharts  &middot; Kyle Walker ">
<meta property="og:site_name" content="Kyle Walker"/>
<meta property="og:url" content="http://walkerke.github.io/2014/06/rcharts-pyramids/" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2014-06-07T00:00:00Z" />
<meta property="og:article:modified_time" content="2014-06-07T00:00:00Z" />

  
    
<meta property="og:article:tag" content="R">
    
<meta property="og:article:tag" content="rCharts">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@kyle_e_walker" />
<meta name="twitter:creator" content="@kyle_e_walker" />
<meta name="twitter:title" content="Interactive international population pyramids with R, rCharts" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="http://walkerke.github.io/2014/06/rcharts-pyramids/" />
<meta name="twitter:domain" content="http://walkerke.github.io/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Interactive international population pyramids with R, rCharts",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2014-06-07",
    "description": "",
    "wordCount":  1664 
  }
</script>



<link rel="canonical" href="http://walkerke.github.io/2014/06/rcharts-pyramids/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://walkerke.github.io/touch-icon-144-precomposed.png">
<link href="http://walkerke.github.io/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.17" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link href='https://fonts.googleapis.com/css?family=Merriweather:300%7CRaleway%7COpen+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="http://walkerke.github.io/css/font-awesome.min.css">
<link rel="stylesheet" href="http://walkerke.github.io/css/style.css">
<link rel="stylesheet" href="http://walkerke.github.io/css/highlight/zenburn.css">

  <!DOCTYPE HTML>
<style>
  
  .main_wrapper>.main_header {
    background-color: #035004;
    color: #fff;
  }
  
  .main_wrapper>.main_content .label:hover,
  .main_wrapper>.main_content .navigation a:hover,
  .main_wrapper>.main_content .pagination a:hover,
  .main_wrapper>.main_content .readlink a:hover,
  .main_wrapper>.main_content h2 a:hover,
  .main_wrapper>.main_header a:hover {
    background-color: #035004;
    color: #fff;
    text-decoration: none; 
}

  a {
    color: #1a730f; 
  }
  
  a:active, a:focus, a:hover {
    color: #035004;
}
  
</style>

</head>
<body class="map[name:superhero]">
  <main id="main-wrapper" class="container main_wrapper has-sidebar">
    <header id="main-header" class="container main_header">
  <div class="container brand">
  <div class="container title h1-like">
  <a class="baselink" href="http://walkerke.github.io/">
  Kyle Walker

</a>

</div>

  
<div class="container topline">
  
  Writing about visualization, demographics, dashboards, and spatial data science. <br/><br/>Interested in learning more?  Hire me for a workshop or to consult on your next project.  See the Services page for more details.


</div>


</div>

  <nav class="container nav primary no-print">
  


  
<a href="http://walkerke.github.io/about">About</a>

<a href="http://walkerke.github.io/post" title="Show list of posts">Posts</a>

<a href="http://walkerke.github.io/tags" title="Show list of tags">Tags</a>

<a href="http://walkerke.github.io/services">Services</a>

<a href="https://www.r-bloggers.com/">R-Bloggers</a>


</nav>

<div class="container nav secondary no-print">
  
<a id="contact-link-email" class="contact_link" href="mailto:kwalkerdata@gmail.com">
  <span class="fa fa-envelope-square"></span><span>email</span></a>



<a id="contact-link-github" class="contact_link" href="https://github.com/walkerke">
  <span class="fa fa-github-square"></span><span>github</span></a>





<a id="contact-link-linkedin" class="contact_link" href="https://www.linkedin.com/in/walkerke">
  <span class="fa fa-linkedin-square"></span><span>linkedin</span></a>







<a id="contact-link-twitter" class="contact_link" href="https://twitter.com/kyle_e_walker">
  <span class="fa fa-twitter-square"></span><span>twitter</span></a>













</div>


  

</header>


<article id="main-content" class="container main_content single">
  <header class="container hat">
  <h1>Interactive international population pyramids with R, rCharts
</h1>

  <div class="metas">
<time datetime="2014-06-07">7 Jun, 2014</time>


  
    &middot; by Kyle Walker
  
  &middot; Read in about 8 min
  &middot; (1664 Words)
  <br>
  
<a class="label" href="http://walkerke.github.io/tags/r">R</a>

<a class="label" href="http://walkerke.github.io/tags/rcharts">rCharts</a>



</div>

</header>

  <div class="container content">
  <p>I find population pyramids to be very effective teaching tools.  In short, a population pyramid is a type of chart that shows the population size of different age cohorts on the x-axis, with gender usually displayed back-to-back to create the shape of a &ldquo;pyramid.&rdquo;  It is used to illustrate a snapshot of the age and sex structure of a population, and can serve as a tool that aids in discussion of many thematic issues such as population growth, aging, and gender imbalance.  The visually appealing structure of the population pyramid also makes it easy to compare the population structures of different countries, which is why I like to use pyramids in my classes.  This is exemplified by <a href="http://blogs.worldbank.org/futuredevelopment/end-population-pyramid">this post from the World Bank</a>, which shows how different &ldquo;shapes&rdquo; of the pyramid reflect different demographic contexts.</p>

<p>I was originally motivated to learn interactive visualization to produce interactive population pyramids.  My inspiration came from these examples from <a href="http://vis.stanford.edu/jheer/d3/pyramid/shift.html">Jeff Heer</a> and <a href="http://bl.ocks.org/mbostock/4062085">Mike Bostock</a>, which use data from the U.S. Census.  Since then, a number of other creative interactive population pyramid applications have gotten a lot of attention, such as <a href="http://populationpyramid.net/">this visualization from Martin De Wulf</a>, and <a href="http://www.nytimes.com/2014/05/13/upshot/a-changing-shape-in-americas-age-distribution.html?rref=upshot&amp;_r=1">this animated graphic from the Pew Research Center</a>, referenced in <em>The New York Times&rsquo;</em> Upshot.</p>

<p>These are all great resources, but I wanted something both re-usable and customizable so that I could embed interactive pyramids for any country I needed in my slide decks for my World Regional Geography course.  To do this, I turned to the fantastic <a href="http://www.census.gov/population/international/data/idb/informationGateway.php">International Data Base from the US Census Bureau</a> for data, and the amazing <a href="http://rcharts.io">rCharts</a> to create the pyramids.  The Census Bureau&rsquo;s International Data Base contains a tremendous amount of information about basic demographic characteristics of the world&rsquo;s countries, and is easily downloaded; I&rsquo;ve had students use it before to create their own population pyramids in Excel for class assignments.  However, as I wanted quick access to the data to in turn create interactive rCharts visualizations, I wrote a script, <code>rcharts_pyramids.R</code>, that includes functions to scrape the Data Base website and produce an interactive pyramid with R within seconds.</p>

<p>Below, I&rsquo;ll discuss how to use the script.  I&rsquo;d like anyone to be able to use this, regardless of their background with R; as such, I&rsquo;m going to go easy on the technical details.  I&rsquo;ll follow up with another more code-heavy post, and <a href="https://github.com/walkerke/teaching-with-datavis/blob/master/pyramids/rcharts_pyramids.R">the code is available on GitHub here</a>.</p>

<hr />

<p>To get started, make sure you have the following R packages installed: <strong>XML</strong>, <strong>reshape2</strong>, <strong>rCharts</strong>, and <strong>plyr</strong>.  <strong>rCharts</strong> is not on CRAN, so you&rsquo;ll need to install it from GitHub with the <strong>devtools</strong> package.  This script requires the <code>dev</code> branch of <strong>rCharts</strong>.  If you are just getting started with R, install the packages with the code below.</p>

<pre><code class="language-r">install.packages(c('XML', 'reshape2', 'devtools', 'plyr'))
library(devtools)
install_github('ramnathv/rCharts@dev')
</code></pre>

<p>Once these packages are installed, you are ready to get started.  If you are using <a href="http://www.rstudio.com/">RStudio</a> (which I strongly recommend), simply enter the following command into the R Console:</p>

<pre><code class="language-r">source('https://raw.githubusercontent.com/walkerke/teaching-with-datavis/master/pyramids/rcharts_pyramids.R')
</code></pre>

<p>If you are not using RStudio, use <code>source_url</code> from the <strong>devtools</strong> package instead of <code>source</code>.  Alternatively, you can get the script from GitHub yourself and load it.</p>

<p>The script contains four functions: <code>getAgeTable</code>, <code>dPyramid</code>, <code>hPyramid</code>, and <code>nPyramid</code>.  <code>getAgeTable</code> is a helper function that uses the <strong>XML</strong> package to scrape data from the International Data Base and convert it into an R data frame.  I pull data from the category &ldquo;Mid-year Population by Five Year Age Groups and Sex&rdquo; to create the pyramids.  The other three functions are used to create population pyramids from the data with different JavaScript libraries available through <strong>rCharts</strong>.  Each function has three parameters:</p>

<ol>
<li><code>country</code> (required): the FIPS 10-4 country code for your country of interest.  You can find the codes from <a href="http://en.wikipedia.org/wiki/List_of_FIPS_country_codes">this Wikipedia page</a>, or use the <a href="https://github.com/vincentarelbundock/countrycode"><strong>countrycode</strong> R package</a>.<br /></li>
<li><code>year</code> (required): The year for which you want to make the pyramid.  The Data Base includes historical information going back to 1950, and projected counts up to 2050 <a href="http://www.census.gov/population/international/data/idb/informationGateway.php">see this link for the Census Bureau&rsquo;s projection methodology</a>.  Not all years are available for all countries, however.<br /></li>
<li><code>colors</code> (optional): A vector of length 2 that contains the colors you want to use for your pyramid.  If you leave this argument blank, you&rsquo;ll get the default colors for your pyramid.<br /></li>
</ol>

<p>Now, let&rsquo;s see how this works!</p>

<hr />

<p>The first example I&rsquo;ll show you is <code>nPyramid</code>, which uses the <a href="http://nvd3.org/">NVD3.js library</a>, which is built on top of D3.  I&rsquo;m going to create a population pyramid for Qatar in 2014.  I spend a fair amount of time talking about Qatar in my course, as it exemplifies many of the topics we cover such as economic inequality, energy and economic growth, and international labor migration.  In fact, <a href="http://www.pewsocialtrends.org/2013/12/17/migration-tables/">around three-quarters of Qatar&rsquo;s population is foreign-born</a>; further, <a href="http://espn.go.com/video/clip?id=11019010&amp;categoryid=2378529">the conditions endured by migrant laborers in Qatar are attracting international attention in the run-up to the 2022 World Cup</a>.</p>

<p>To create the visualization, simply type the following command into your R console:</p>

<pre><code class="language-r">nPyramid('QA', 2014, colors = c('darkred', 'silver'))
</code></pre>

<p>Which produces the chart below. I have trouble with NVD3 in the RStudio viewer, so you may need to open it in a web browser if you are using RStudio.</p>

<iframe src="http://walkerke.github.io/teaching-with-datavis/pyramids/qatar.html" width="850" height="400" seamless scrolling="no" frameBorder = "0"></iframe>

<p>The pyramid is striking for the dramatic gender imbalance in Qatar introduced by the influx of foreign laborers to the country.  Males aged 30-34 number nearly 300,000; this is over four times the number of females in that age category, who number just over 70,000.  Admittedly, population pyramids like this can be problematic for making gender comparisons (<a href="http://bl.ocks.org/mbostock/4062085">Mike Bostock argues as much here</a>), but this is allayed somewhat when using these pyramids interactively, as the visualizations produce a tooltip on hover that returns the precise population count for the age cohort, allowing for comparisons of the numbers.</p>

<hr />

<p>The next example comes from <a href="http://www.highcharts.com/">Highcharts</a>, an interactive JavaScript charting library that includes many different examples and is very well-documented.  I&rsquo;m going to use Highcharts here to create an interactive population pyramid for Japan in 2050 with the <code>hPyramid</code> function.  In class, we discussed the <a href="http://www.economist.com/news/asia/21603076-first-time-proper-debate-starting-about-immigration-incredible-shrinking-country?spc=scode&amp;spv=xm&amp;ah=9d7f7ab945510a56fa6d37c30b6f1709">challenges Japan is facing as its population ages</a>; this population pyramid provided important visual context.  To create the chart, use the code below:</p>

<pre><code class="language-r">hPyramid('JA', 2050, colors = c('blue', 'red'))
</code></pre>

<iframe src="http://walkerke.github.io/teaching-with-datavis/pyramids/japan2050.html" width="850" height="400" seamless scrolling="no" frameBorder = "0"></iframe>

<p>Japan&rsquo;s projected population structure in 2050 exemplifies an &ldquo;inverted&rdquo; population pyramid, with the oldest age cohorts comprising the largest proportions of the population, and the youngest the smallest.  There are many reasons why this is projected to happen in Japan, including high life expectancy, restrictive immigration policies, and declining marriage rates (contributing to low fertility levels).  In turn, Japan&rsquo;s shrinking workforce will have to provide for an increasingly large elderly population, which is illustrated in the chart.  As with the NVD3 pyramid, the chart gives a tooltip on mouseover that returns specific population figures.  One of the most striking features of the pyramid this reveals is the population of female centenarians (people aged 100+), which is projected to exceed 1 million by 2050 as per the Census Bureau.</p>

<hr />

<p>The last example I&rsquo;ll show you is <code>dPyramid</code>, which uses the <a href="http://dimplejs.org/">DimpleJS</a> library, built on top of D3.  <code>dPyramid</code> works in much the same way as the other functions, but has the added bonus of being able to take advantage of Dimple&rsquo;s <code>storyboard</code> property, which facilitates the creation of temporal animations.  As such, <code>dPyramid</code> accepts a vector of years for the <code>year</code> parameter; if you choose multiple years instead of a single year, <code>dPyramid</code> will give you a population pyramid that changes over time.  Here&rsquo;s an example that shows the aging of Germany&rsquo;s population between 2000 and 2050.  If you are new to R, the <code>seq</code> function returns a sequence of numbers from argument 1 (in this case, the year 2000), to argument 2 (2050), in intervals of argument 3 (every 10 years).</p>

<pre><code class="language-r">dPyramid('GM', seq(2000, 2050, 10), colors = c('black', 'red'))
</code></pre>

<iframe src="http://walkerke.github.io/teaching-with-datavis/pyramids/germany.html" width="850" height="425" seamless scrolling="no" frameBorder = "0"></iframe>

<p>The animation does a compelling job of showing how Germany&rsquo;s population is projected to both age and shrink in the years ahead.  Animation can also be used to provide demographic context to key historical circumstances I teach about in class.  For example, I covered the devastation wrought by the <a href="http://www.aljazeera.com/indepth/features/2012/02/20122314155454169.html">Khmer Rouge</a> during the Cambodian genocide, and used the animated population pyramid below to illustrate the demographic impacts of the genocide. The chart covers 1974 to 1982, the time just before, during, and in the years following the Khmer Rouge.</p>

<pre><code class="language-r">dPyramid('CB', seq(1974, 1982, 1))
</code></pre>

<iframe src="http://walkerke.github.io/teaching-with-datavis/pyramids/cambodia.html" width="850" height="425" seamless scrolling="no" frameBorder = "0"></iframe>

<p>You can see how the bars shrink between 1975 and 1979, the years when Cambodia was ruled by the Khmer Rouge.  I could see the shock on some of my students&rsquo; faces when I showed this to them - many of them were unfamiliar with the history of Cambodia and the Khmer Rouge.  The visualization shows an overall decline in population of around 900,000 between 1974 and 1979, which reflects official population numbers; this likely underestimates the scale of the atrocities in Cambodia (<a href="http://www.yale.edu/gsp/publications/KiernanRevised1.pdf">see the article linked here</a>), as the actual losses may have been twice that.</p>

<p>To save any of your pyramids as a standalone HTML document, just assign your pyramid to a variable and use rCharts&rsquo; <code>save</code> option to save your chart, setting the <code>cdn</code> parameter to <code>TRUE</code>.  The code below provides an example of how to save the html file in your working directory.</p>

<pre><code class="language-r">q1 &lt;- nPyramid('QA', 2014, colors = c('darkred', 'silver'))
q1$save('qatar.html', cdn = TRUE)
</code></pre>

<hr />

<p>I&rsquo;ve learned a lot about rCharts as I&rsquo;ve put these together; my next post will cover how these charts are created.  In the meantime, have a look at the <a href="https://github.com/walkerke/teaching-with-datavis/blob/master/pyramids/rcharts_pyramids.R">code on GitHub</a>; you are welcome to use and modify it as you please.  I&rsquo;d love to hear your comments or feedback; you can contact me at <a href="mailto:kyle.walker@tcu.edu">kyle.walker@tcu.edu</a> or get in touch with me on <a href="https://twitter.com/kyle_e_walker">Twitter</a>.</p>

<p><strong>Thanks to:</strong></p>

<ul>
<li><a href="https://twitter.com/ramnath_vaidya">Ramnath Vaidyanathan</a>, <a href="https://twitter.com/timelyportfolio">Timely Portfolio</a>, and <a href="https://twitter.com/jkiernander">John Kiernander</a> for their incredible contributions that make this all possible - and for helping me out with some Dimple formatting issues;</li>
<li>The authors of the NVD3, D3, and Highcharts JavaScript libraries;</li>
<li>The US Census Bureau for making the International Data Base such a valuable resource.<br /></li>
</ul>

</div>


  <footer class="container">
  <div class="container navigation no-print">
  <h2>Navigation</h2>
  
  

    
    <a class="prev" href="http://walkerke.github.io/2014/05/tourism-plotly/" title="Visualizing the economics of tourism in the Pacific with Plotly">
      Previous
    </a>
    

    
    <a class="next" href="http://walkerke.github.io/2014/08/un-projections/" title="Exploring the United Nations population projections with rCharts">
      Next
    </a>
    

  


</div>

  

</footer>

</article>
      <footer id="main-footer" class="container main_footer">
  

  <div class="container nav foot no-print">
  

  <a class="toplink" href="#">back to top</a>

</div>

  <div class="container credits">
  
<div class="container footline">
  

</div>


  
<div class="container copyright">
  
  &copy; 2017 Kyle Walker


</div>


</div>

</footer>

    </main>
    
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//your_disqus_shortname.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="http://walkerke.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51388803-1', 'auto');
  ga('send', 'pageview');

</script>


    
  </body>
</html>

